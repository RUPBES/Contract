@using BusinessLayer.Helpers;
@model MvcLayer.Models.Reports.ScopeWorkContractViewModel
<style>
    .first-col,
    .second-col,
    .third-col,
    .fourth-col,
    .fifth-col,
    .sixth-col {
        position: sticky !important;
        left: -10px;
        z-index: 1;
    }

    th.first-col,
    th.second-col,
    th.third-col,
    th.fourth-col,
    th.fifth-col,
    th.sixth-col {
        z-index: 3;
    }

    thead th.first-col,
    thead th.second-col,
    thead th.third-col,
    thead th.fourth-col,
    thead th.fifth-col,
    thead th.sixth-col {
        position: sticky !important;
        z-index: 6 !important;
    }

    td.third-col,
    td.fourth-col,
    td.fifth-col,
    td.sixth-col {
        background: #5f7b99;
        color: white;
        font-weight: 600;
    }

    .modal-content {
        background-color: white !important;
    }

    .btn_container {
        display: flex;
        width: 100%;
        justify-content: space-between;
        margin-bottom: 1%;
    }

    .img_btn {
        width: 24px;
        height: 24px;
        margin-right: 2px;
        transition-property: transform;
        transition-duration: 1s;
        transition-timing-function: ease-in-out;
    }

    .btn-primary:hover > .img_btn {
        transform: rotate(180deg);
    }
</style>

<div id="ConstructionInstallationWorksByTypes" class="d-none">
    <div class="modal-content" style="width : 99vw">
        <div class="modal-body">
            <div class="btn_container">
                <button class="btn btn-primary" id="ChangeToCategories" onclick="funcChangeToCategories()"><img src="~/icons/circular_icon.png" class="img_btn" />Сменить вид</button>
                <div> @Model.AmendmentInfo</div>
                <a id="buttonTableType" onclick="funcCloseByTableType()" class="close-btn"> </a>
            </div>
            <hr class="modal-line" />
            <div class="full-width" style="width: 100%">
                <table class="PartialTable table table-striped table-hover">
                    <thead class="Partialtable-sticky-top">
                        <tr>
                            @*Виды работ по договору*@
                            <th class="first-col"><span>Вид работ</span></th>
                            <th class="second-col"><span>Категория работ</span></th>
                            @*Контрактная договорная цена*@
                            <th class="third-col"><span>Контрактная цена, с НДС</span></th>
                            @*Выполнено на 01.01 текущего года*@
                            <th class="fourth-col"><span>Выполнено на 01.01 тек. года</span></th>
                            @*Остаток по выполнению от стоимости контрактной цены*@
                            <th class="fifth-col"><span>Остаток по выполнению</span></th>
                            @*Объем на текущий год*@
                            <th class="sixth-col"><span>Объем на текущий год</span></th>
                            @*Период (месяц)*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                <th>
                                    <span>@iterator.Value.ToString("MMMM")-@iterator.Value.Year</span>
                                </th>
                            }
                        </tr>
                    </thead>
                    <tbody class="tbodyPartialTableModal">
                        @*Объем работ - План*@
                        <tr id="all" >
                            @if (ViewData["Main"] != null)
                            {
                                <th class="first-col" rowspan="4"><span>Стоимость работ по договору</span></th>
                            }
                            else
                            {
                                <th class="first-col" rowspan="2"><span>Стоимость работ по договору</span></th>
                            }
                            <th class="second-col"><span>План</span></th>
                            <td class="third-col" rowspan="2"><span>@Model.contractPrice.TotalCost?.ToString("N2")</span></td>
                            <td class="fourth-col" rowspan="2"><span>@Model.workTodayYear.TotalCost?.ToString("N2")</span></td>
                            <td class="fifth-col" rowspan="2"><span>@Model.remainingScope.TotalCost?.ToString("N2")</span></td>
                            <td class="sixth-col" rowspan="2"><span>@Model.todayScope.TotalCost?.ToString("N2")</span></td>
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = @obj.TotalCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @*Объем работ - Факт*@
                        <tr >
                            <th class="second-col"><span>Факт</span></th>
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.TotalCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @if (ViewData["Main"] != null)
                        {
                            @*Объем работ - План(свои)*@
                            <tr >
                                <th class="second-col"><span>План своими силами</span></th>
                                <td class="third-col" rowspan="2"><span>@((Model.contractPrice.TotalCost - Model.contractPriceOwn?.TotalCost)?.ToString("N2"))</span></td>
                                <td class="fourth-col" rowspan="2"><span>@((Model.workTodayYear.TotalCost - Model.workTodayYearOwn?.TotalCost)?.ToString("N2"))</span></td>
                                <td class="fifth-col" rowspan="2"><span>@((Model.remainingScope.TotalCost - Model.remainingScopeOwn?.TotalCost)?.ToString("N2"))</span></td>
                                <td class="sixth-col" rowspan="2"><span>@((Model.todayScope.TotalCost - Model.todayScopeOwn?.TotalCost)?.ToString("N2"))</span></td>
                                @*Стоимость ?*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.TotalCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.TotalCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.TotalCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>

                            @*Объем работ - Факт(свои)*@
                            <tr >
                                <th class="second-col"><span> Факт своими силами</span></th>
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.TotalCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.TotalCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.TotalCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>
                        }

                        @*СМР - План*@
                        <tr id="smr" >
                            @if (ViewData["Main"] != null)
                            {
                                <th class="first-col" rowspan="4"><span>Неизменная цена СМР</span></th>
                            }
                            else
                            {
                                <th class="first-col" rowspan="2"><span>Неизменная цена СМР</span></th>
                            }
                            <th class="second-col"><span>План</span></th>
                            <td class="third-col" rowspan="2"><span>@Model.contractPrice.SmrCost?.ToString("N2")</span></td>
                            <td class="fourth-col" rowspan="2"><span>@Model.workTodayYear.SmrCost?.ToString("N2")</span></td>
                            <td class="fifth-col" rowspan="2"><span>@Model.remainingScope.SmrCost?.ToString("N2")</span></td>
                            <td class="sixth-col" rowspan="2"><span>@Model.todayScope.SmrCost?.ToString("N2")</span></td>
                            @*Стоимость СМР*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = @obj.SmrCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @*СМР - Факт*@
                        <tr >
                            <th class="second-col"><span>Факт</span></th>
                            @*Стоимость СМР*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.SmrCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @if (ViewData["Main"] != null)
                        {
                            @*СМР - План(свои)*@
                            <tr>
                                <th class="second-col"><span>План своими силами</span></th>
                                <td class="third-col" rowspan="2"><span>@((Model.contractPrice.SmrCost - Model.contractPriceOwn?.SmrCost)?.ToString("N2"))</span></td>
                                <td class="fourth-col" rowspan="2"><span>@((Model.workTodayYear.SmrCost - Model.workTodayYearOwn?.SmrCost)?.ToString("N2"))</span></td>
                                <td class="fifth-col" rowspan="2"><span>@((Model.remainingScope.SmrCost - Model.remainingScopeOwn?.SmrCost)?.ToString("N2"))</span></td>
                                <td class="sixth-col" rowspan="2"><span>@((Model.todayScope.SmrCost - Model.todayScopeOwn?.SmrCost)?.ToString("N2"))</span></td>

                                @*Стоимость СМР*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.SmrCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.SmrCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.SmrCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>

                            @*СМР - Факт(свои)*@
                            <tr>
                                <th class="second-col"><span> Факт своими силами</span></th>
                                @*Стоимость СМР*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.SmrCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.SmrCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.SmrCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>
                        }

                        @*ПНР - План*@
                        <tr id="pnr" >
                            @if (ViewData["Main"] != null)
                            {
                                <th class="first-col" rowspan="4"><span>ПНР</span></th>
                            }
                            else
                            {
                                <th class="first-col" rowspan="2"><span>ПНР</span></th>
                            }
                            <th class="second-col"><span>План</span></th>
                            <td class="third-col" rowspan="2"><span>@Model.contractPrice.PnrCost?.ToString("N2")</span></td>
                            <td class="fourth-col" rowspan="2"><span>@Model.workTodayYear.PnrCost?.ToString("N2")</span></td>
                            <td class="fifth-col" rowspan="2"><span>@Model.remainingScope.PnrCost?.ToString("N2")</span></td>
                            <td class="sixth-col" rowspan="2"><span>@Model.todayScope.PnrCost?.ToString("N2")</span></td>
                            @*Стоимость ПНР*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.PnrCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @*ПНР - Факт*@
                        <tr >
                            <th class="second-col"><span>Факт</span></th>
                            @*Стоимость ПНР*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.PnrCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @if (ViewData["Main"] != null)
                        {
                            @*ПНР - План(свои)*@
                            <tr >
                                <th class="second-col"><span>План своими силами</span></th>
                                <td class="third-col" rowspan="2"><span>@((Model.contractPrice.PnrCost - Model.contractPriceOwn?.PnrCost)?.ToString("N2"))</span></td>
                                <td class="fourth-col" rowspan="2"><span>@((Model.workTodayYear.PnrCost - Model.workTodayYearOwn?.PnrCost)?.ToString("N2"))</span></td>
                                <td class="fifth-col" rowspan="2"><span>@((Model.remainingScope.PnrCost - Model.remainingScopeOwn?.PnrCost)?.ToString("N2"))</span></td>
                                <td class="sixth-col" rowspan="2"><span>@((Model.todayScope.PnrCost - Model.todayScopeOwn?.PnrCost)?.ToString("N2"))</span></td>
                                @*Стоимость ПНР*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.PnrCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.PnrCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.PnrCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>

                            @*ПНР - Факт(свои)*@
                            <tr >
                                <th class="second-col"><span> Факт своими силами</span></th>
                                @*Стоимость ПНР*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.PnrCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.PnrCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.PnrCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>
                        }

                        @*Доп. работы - План*@
                        <tr id="optionnaly">
                            @if (ViewData["Main"] != null)
                            {
                                <th class="first-col" rowspan="4"><span>Доп. работы</span></th>
                            }
                            else
                            {
                                <th class="first-col" rowspan="2"><span>Доп. работы</span></th>
                            }
                            <th class="second-col"><span>План</span></th>
                            <td class="third-col" rowspan="2"><span>@Model.contractPrice.AdditionalCost?.ToString("N2")</span></td>
                            <td class="fourth-col" rowspan="2"><span>@Model.workTodayYear.AdditionalCost?.ToString("N2")</span></td>
                            <td class="fifth-col" rowspan="2"><span>@Model.remainingScope.AdditionalCost?.ToString("N2")</span></td>
                            <td class="sixth-col" rowspan="2"><span>@Model.todayScope.AdditionalCost?.ToString("N2")</span></td>
                            @*Стоимость Доп. работы*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.AdditionalCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@string.Format("{0:n}", sum)</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @*Доп. работы - Факт*@
                        <tr>
                            <th class="second-col"><span>Факт</span></th>
                            @*Стоимость Доп. работы*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.AdditionalCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @if (ViewData["Main"] != null)
                        {
                            @*Доп. работы - План(свои)*@
                            <tr>
                                <th class="second-col"><span>План своими силами</span></th>
                                <td class="third-col" rowspan="2"><span>@((Model.contractPrice.AdditionalCost - Model.contractPriceOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                <td class="fourth-col" rowspan="2"><span>@((Model.workTodayYear.AdditionalCost - Model.workTodayYearOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                <td class="fifth-col" rowspan="2"><span>@((Model.remainingScope.AdditionalCost - Model.remainingScopeOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                <td class="sixth-col" rowspan="2"><span>@((Model.todayScope.AdditionalCost - Model.todayScopeOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                @*Стоимость Доп. работы*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.AdditionalCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.AdditionalCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.AdditionalCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>

                            @*Доп. работы - Факт(свои)*@
                            <tr>
                                <th class="second-col"><span> Факт своими силами</span></th>
                                @*Стоимость Доп. работы*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.AdditionalCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.AdditionalCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.AdditionalCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>
                        }

                        @*Оборудование - План*@
                        <tr id="equip" >
                            @if (ViewData["Main"] != null)
                            {
                                <th class="first-col" rowspan="4"><span>Оборудование генподрядчика</span></th>
                            }
                            else
                            {
                                <th class="first-col" rowspan="2"><span>Оборудование генподрядчика</span></th>
                            }
                            <th class="second-col"><span>План</span></th>
                            <td class="third-col" rowspan="2"><span>@Model.contractPrice.EquipmentCost?.ToString("N2")</span></td>
                            <td class="fourth-col" rowspan="2"><span>@Model.workTodayYear.EquipmentCost?.ToString("N2")</span></td>
                            <td class="fifth-col" rowspan="2"><span>@Model.remainingScope.EquipmentCost?.ToString("N2")</span></td>
                            <td class="sixth-col" rowspan="2"><span>@Model.todayScope.EquipmentCost?.ToString("N2")</span></td>
                            @*Стоимость Оборудование*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.EquipmentCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @*Оборудование - Факт*@
                        <tr >
                            <th class="second-col"><span>Факт</span></th>
                            @*Стоимость Оборудование*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.EquipmentCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td> </td>
                                }
                            }
                        </tr>

                        @if (ViewData["Main"] != null)
                        {
                            @*Оборудование - План(свои)*@
                            <tr >
                                <th class="second-col"><span>План своими силами</span></th>
                                <td class="third-col" rowspan="2"><span>@((Model.contractPrice.EquipmentCost - Model.contractPriceOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                <td class="fourth-col" rowspan="2"><span>@((Model.workTodayYear.EquipmentCost - Model.workTodayYearOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                <td class="fifth-col" rowspan="2"><span>@((Model.remainingScope.EquipmentCost - Model.remainingScopeOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                <td class="sixth-col" rowspan="2"><span>@((Model.todayScope.EquipmentCost - Model.todayScopeOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                @*Стоимость Оборудование*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.EquipmentCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.EquipmentCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.EquipmentCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>

                            @*Оборудование - Факт(свои)*@
                            <tr >
                                <th class="second-col"><span> Факт своими силами</span></th>
                                @*Стоимость Оборудование*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.EquipmentCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.EquipmentCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.EquipmentCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>
                        }

                        @*Прочие работы и услуги - План*@
                        <tr id="other" >
                            @if (ViewData["Main"] != null)
                            {
                                <th class="first-col" rowspan="4"><span>Прочие работы и услуги</span></th>
                            }
                            else
                            {
                                <th class="first-col" rowspan="2"><span>Прочие работы и услуги</span></th>
                            }
                            <th class="second-col"><span>План</span></th>
                            <td class="third-col" rowspan="2"><span>@Model.contractPrice.OtherExpensesCost?.ToString("N2")</span></td>
                            <td class="fourth-col" rowspan="2"><span>@Model.workTodayYear.OtherExpensesCost?.ToString("N2")</span></td>
                            <td class="fifth-col" rowspan="2"><span>@Model.remainingScope.OtherExpensesCost?.ToString("N2")</span></td>
                            <td class="sixth-col" rowspan="2"><span>@Model.todayScope.OtherExpensesCost?.ToString("N2")</span></td>
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.OtherExpensesCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @*Прочие работы и услуги - Факт*@
                        <tr >
                            <th class="second-col"><span>Факт</span></th>
                            @*Стоимость ?*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.OtherExpensesCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @if (ViewData["Main"] != null)
                        {
                            @*Прочие работы и услуги - План(свои)*@
                            <tr>
                                <th class="second-col"><span>План своими силами</span></th>
                                <td class="third-col" rowspan="2"><span>@((Model.contractPrice.OtherExpensesCost - Model.contractPriceOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                <td class="fourth-col" rowspan="2"><span>@((Model.workTodayYear.OtherExpensesCost - Model.workTodayYearOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                <td class="fifth-col" rowspan="2"><span>@((Model.remainingScope.OtherExpensesCost - Model.remainingScopeOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                <td class="sixth-col" rowspan="2"><span>@((Model.todayScope.OtherExpensesCost - Model.todayScopeOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.OtherExpensesCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.OtherExpensesCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.OtherExpensesCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>

                            @*Прочие работы и услуги - Факт(свои)*@
                            <tr >
                                <th class="second-col"><span> Факт своими силами</span></th>
                                @*Стоимость ?*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.OtherExpensesCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.OtherExpensesCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.OtherExpensesCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>
                        }

                        @*Всего, без НДС - План*@
                        <tr id="allWithoutNDS" >
                            @if (ViewData["Main"] != null)
                            {
                                <th class="first-col" rowspan="4"><span>Всего по договору без НДС (справочно)</span></th>
                            }
                            else
                            {
                                <th class="first-col" rowspan="2"><span>Всего по договору без НДС (справочно)</span></th>
                            }
                            <th class="second-col"><span>План</span></th>
                            <td class="third-col" rowspan="2"><span>@Model.contractPrice.TotalWithoutNds?.ToString("N2")</span></td>
                            <td class="fourth-col" rowspan="2"><span>@Model.workTodayYear.TotalWithoutNds?.ToString("N2")</span></td>
                            <td class="fifth-col" rowspan="2"><span>@Model.remainingScope.TotalWithoutNds?.ToString("N2")</span></td>
                            <td class="sixth-col" rowspan="2"><span>@Model.todayScope.TotalWithoutNds?.ToString("N2")</span></td>
                            @*Стоимость ?*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.TotalWithoutNds;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @*Всего, без НДС - Факт*@
                        <tr >
                            <th class="second-col"><span>Факт</span></th>
                            @*Стоимость ?*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.TotalWithoutNds;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @if (ViewData["Main"] != null)
                        {
                            @*Всего, без НДС - План(свои)*@
                            <tr >
                                <th class="second-col"><span>План своими силами</span></th>
                                <td class="third-col" rowspan="2"><span>@((Model.contractPrice.TotalWithoutNds - Model.contractPriceOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                <td class="fourth-col" rowspan="2"><span>@((Model.workTodayYear.TotalWithoutNds - Model.workTodayYearOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                <td class="fifth-col" rowspan="2"><span>@((Model.remainingScope.TotalWithoutNds - Model.remainingScopeOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                <td class="sixth-col" rowspan="2"><span>@((Model.todayScope.TotalWithoutNds - Model.todayScopeOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                @*Стоимость ?*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.TotalWithoutNds;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.TotalWithoutNds - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.TotalWithoutNds?.ToString("N2")</td>
                                    }
                                }
                            </tr>

                            @*Всего, без НДС - Факт(свои)*@
                            <tr>
                                <th class="second-col"><span> Факт своими силами</span></th>
                                @*Стоимость ?*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.TotalWithoutNds;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.TotalWithoutNds - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.TotalWithoutNds?.ToString("N2")</td>
                                    }
                                }
                            </tr>
                        }
                       
                        @*Материалы заказчика - План*@
                        <tr id="material" >
                            @if (ViewData["Main"] != null)
                            {
                                <th class="first-col" rowspan="4"><span>Материалы заказчика (справочно)</span></th>
                            }
                            else
                            {
                                <th class="first-col" rowspan="2"><span>Материалы заказчика (справочно)</span></th>
                            }
                            <th class="second-col"><span>План</span></th>
                            <td class="third-col" rowspan="2"><span>@Model.contractPrice.MaterialCost?.ToString("N2")</span></td>
                            <td class="fourth-col" rowspan="2"><span>@Model.workTodayYear.MaterialCost?.ToString("N2")</span></td>
                            <td class="fifth-col" rowspan="2"><span>@Model.remainingScope.MaterialCost?.ToString("N2")</span></td>
                            <td class="sixth-col" rowspan="2"><span>@Model.todayScope.MaterialCost?.ToString("N2")</span></td>
                            @*Стоимость Материалы*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.MaterialCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @*Материалы заказчика - Факт*@
                        <tr >
                            <th class="second-col"><span>Факт</span></th>
                            @*Стоимость Материалы*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.MaterialCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @if (ViewData["Main"] != null)
                        {
                            @*Материалы заказчика - План(свои)*@
                            <tr >
                                <th class="second-col"><span>План своими силами</span></th>
                                <td class="third-col" rowspan="2"><span>@((Model.contractPrice.MaterialCost - Model.contractPriceOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                <td class="fourth-col" rowspan="2"><span>@((Model.workTodayYear.MaterialCost - Model.workTodayYearOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                <td class="fifth-col" rowspan="2"><span>@((Model.remainingScope.MaterialCost - Model.remainingScopeOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                <td class="sixth-col" rowspan="2"><span>@((Model.todayScope.MaterialCost - Model.todayScopeOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                @*Стоимость Материалы*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.MaterialCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.MaterialCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.MaterialCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>

                            @*Материалы заказчика - Факт(свои)*@
                            <tr >
                                <th class="second-col"><span> Факт своими силами</span></th>
                                @*Стоимость Материалы*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.MaterialCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.MaterialCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.MaterialCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>
                        }

                        @*Оборудование заказчика - План*@
                        <tr id="equipment">
                            @if (ViewData["Main"] != null)
                            {
                                <th class="first-col" rowspan="4"><span>Оборудование заказчика (справочно)</span></th>
                            }
                            else
                            {
                                <th class="first-col" rowspan="2"><span>Оборудование заказчика (справочно)</span></th>
                            }
                            <th class="second-col"><span>План</span></th>
                            <td class="third-col" rowspan="2"><span>@Model.contractPrice.EquipmentClientCost?.ToString("N2")</span></td>
                            <td class="fourth-col" rowspan="2"><span>@Model.workTodayYear.EquipmentClientCost?.ToString("N2")</span></td>
                            <td class="fifth-col" rowspan="2"><span>@Model.remainingScope.EquipmentClientCost?.ToString("N2")</span></td>
                            <td class="sixth-col" rowspan="2"><span>@Model.todayScope.EquipmentClientCost?.ToString("N2")</span></td>
                            @*Стоимость Оборудование заказчика*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.EquipmentClientCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @*Оборудование заказчика - Факт*@
                        <tr>
                            <th class="second-col"><span>Факт</span></th>
                            @*Стоимость Оборудование заказчика*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                decimal? sum;
                                if (obj != null)
                                {
                                    sum = obj.EquipmentClientCost;
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@sum?.ToString("N2")</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                                else
                                {
                                    <td></td>
                                }
                            }
                        </tr>

                        @if (ViewData["Main"] != null)
                        {
                            @*Оборудование заказчика - План(свои)*@
                            <tr>
                                <th class="second-col"><span>План своими силами</span></th>
                                <td class="third-col" rowspan="2"><span>@((Model.contractPrice.EquipmentClientCost - Model.contractPriceOwn?.EquipmentClientCost)?.ToString("N2"))</span></td>
                                <td class="fourth-col" rowspan="2"><span>@((Model.workTodayYear.EquipmentClientCost - Model.workTodayYearOwn?.EquipmentClientCost)?.ToString("N2"))</span></td>
                                <td class="fifth-col" rowspan="2"><span>@((Model.remainingScope.EquipmentClientCost - Model.remainingScopeOwn?.EquipmentClientCost)?.ToString("N2"))</span></td>
                                <td class="sixth-col" rowspan="2"><span>@((Model.todayScope.EquipmentClientCost - Model.todayScopeOwn?.EquipmentClientCost)?.ToString("N2"))</span></td>
                                @*Стоимость Оборудование заказчика*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.EquipmentClientCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.EquipmentClientCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.EquipmentClientCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>

                            @*Оборудование заказчика - Факт(свои)*@
                            <tr>
                                <th class="second-col"><span> Факт своими силами</span></th>
                                @*Стоимость Оборудование заказчика*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.EquipmentClientCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.EquipmentClientCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.EquipmentClientCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="ConstructionInstallationWorksByCategories" class="show">
    <div class="modal-content" style="width : 99vw">
        <div class="modal-body">
            @if (ViewData["Engin"] == null)
            {
                <div class="btn_container">
                    <button class="btn btn-primary" id="ChangeToType" onclick="funcChangeToType()"><img src="~/icons/circular_icon.png" class="img_btn" />Сменить вид</button>
                    <div style="color:red; font-weight:700;">@Model.AmendmentInfo</div>
                    <a id="buttonTableCategories" onclick="funcCloseByTableCategories()" class="close-btn"> </a>
                </div>
            }
            <hr class="modal-line" />

            <div class="full-width" style="width: 100%">
                <table class="PartialTable table table-striped table-hover">
                    <thead class="Partialtable-sticky-top">
                        <tr>
                            @*Виды работ по договору*@
                            <th class="first-col"><span>Категория работ</span></th>
                            <th class="second-col"><span>Вид работ</span></th>
                            @*Контрактная договорная цена*@
                            <th class="third-col"><span>Контрактная цена, с НДС</span></th>
                            @*Выполнено на 01.01 текущего года*@
                            <th class="fourth-col"><span>Выполнено на 01.01 тек. года</span></th>
                            @*Остаток по выполнению от стоимости контрактной цены*@
                            <th class="fifth-col"><span>Остаток по выполнению</span></th>
                            @*Объем на текущий год*@
                            <th class="sixth-col"><span>Объем на текущий год</span></th>
                            @*Период (месяц)*@
                            @for (var iterator = Model.scopes.FirstOrDefault().Period;
                            Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                            iterator = iterator.Value.AddMonths(1))
                            {
                                <th>
                                    <span>@iterator?.ToString("MMMM yyyy")</span>
                                </th>
                            }
                        </tr>
                    </thead>
                    <tbody class="tbodyPartialTableModal">
                        @if (ViewData["Engin"] == null)
                        {
                            @*Объем работ - План*@
                            <tr id="plan" >
                                <th class="first-col" rowspan="9"><span>План</span></th>
                                <th class="second-col"><span>Стоимость работ по договору</span></th>
                                <td class="third-col"><span>@Model.contractPrice.TotalCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.TotalCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.TotalCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.TotalCost?.ToString("N2")</span></td>
                                @*Стоимость ?*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.TotalCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*СМР - План*@
                            <tr>
                                <th class="second-col"><span>Неизменная цена СМР</span></th>
                                <td class="third-col"><span>@Model.contractPrice.SmrCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.SmrCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.SmrCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.SmrCost?.ToString("N2")</span></td>
                                @*Стоимость СМР*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.SmrCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*ПНР - План*@
                            <tr>
                                <th class="second-col"><span>ПНР</span></th>
                                <td class="third-col"><span>@Model.contractPrice.PnrCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.PnrCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.PnrCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.PnrCost?.ToString("N2")</span></td>
                                @*Стоимость ПНР*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = @obj.PnrCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Доп. работы - План*@
                            <tr>
                                <th class="second-col"><span>Доп. работы</span></th>
                                <td class="third-col"><span>@Model.contractPrice.AdditionalCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.AdditionalCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.AdditionalCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.AdditionalCost?.ToString("N2")</span></td>
                                @*Стоимость Доп. работы*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.AdditionalCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Оборудование - План*@
                            <tr >
                                <th class="second-col"><span>Оборудование генподрядчика</span></th>
                                <td class="third-col"><span>@Model.contractPrice.EquipmentCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.EquipmentCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.EquipmentCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.EquipmentCost?.ToString("N2")</span></td>
                                @*Стоимость Оборудование*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.EquipmentCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Прочие работы и услуги - План*@
                            <tr>
                                <th class="second-col"><span>Прочие работы и услуги</span></th>
                                <td class="third-col"><span>@Model.contractPrice.OtherExpensesCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.OtherExpensesCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.OtherExpensesCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.OtherExpensesCost?.ToString("N2")</span></td>
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.OtherExpensesCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Всего, без НДС - План*@
                            <tr>
                                <th class="second-col"><span>Всего по договору без НДС (справочно)</span></th>
                                <td class="third-col"><span>@Model.contractPrice.TotalWithoutNds?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.TotalWithoutNds?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.TotalWithoutNds?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.TotalWithoutNds?.ToString("N2")</span></td>
                                @*Стоимость ?*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.TotalWithoutNds;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>
                            
                            @*Материалы заказчика - План*@
                            <tr>
                                <th class="second-col"><span>Материалы Заказчика (справочно)</span></th>
                                <td class="third-col"><span>@Model.contractPrice.MaterialCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.MaterialCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.MaterialCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.MaterialCost?.ToString("N2")</span></td>
                                @*Стоимость Материалы*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.MaterialCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Оборудование заказчика - План*@
                            <tr>
                                <th class="second-col"><span>Оборудование Заказчика (справочно)</span></th>
                                <td class="third-col"><span>@Model.contractPrice.EquipmentClientCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.EquipmentClientCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.EquipmentClientCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.EquipmentClientCost?.ToString("N2")</span></td>
                                @*Стоимость Оборудование заказчика*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.EquipmentClientCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Стоимость работ по договору - Факт*@
                            <tr id="fact" >
                                <th rowspan="9" class="first-col"><span>Факт</span></th>
                                <th class="second-col"><span>Стоимость работ</span></th>
                                <td class="third-col"><span>@Model.contractPrice.TotalCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.TotalCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.TotalCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.TotalCost?.ToString("N2")</span></td>
                                @*Период*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.TotalCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*СМР - Факт*@
                            <tr >
                                <th class="second-col"><span>Неизменная цена СМР</span></th>
                                <td class="third-col"><span>@Model.contractPrice.SmrCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.SmrCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.SmrCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.SmrCost?.ToString("N2")</span></td>
                                @*Стоимость СМР*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.SmrCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*ПНР - Факт*@
                            <tr >
                                <th class="second-col"><span>ПНР</span></th>
                                <td class="third-col"><span>@Model.contractPrice.PnrCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.PnrCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.PnrCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.PnrCost?.ToString("N2")</span></td>
                                @*Стоимость ПНР*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.PnrCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Доп. работы - Факт*@
                            <tr>
                                <th class="second-col"><span>Доп. работы</span></th>
                                <td class="third-col"><span>@Model.contractPrice.AdditionalCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.AdditionalCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.AdditionalCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.AdditionalCost?.ToString("N2")</span></td>
                                @*Стоимость Доп. работы*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.AdditionalCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Оборудование - Факт*@
                            <tr >
                                <th class="second-col"><span>Оборудование генподрядчика</span></th>
                                <td class="third-col"><span>@Model.contractPrice.EquipmentCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.EquipmentCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.EquipmentCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.EquipmentCost?.ToString("N2")</span></td>
                                @*Стоимость Оборудование*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.EquipmentCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td> </td>
                                    }
                                }
                            </tr>

                            @*Прочие работы - Факт*@
                            <tr >
                                <th class="second-col"><span>Прочие работы и услуги</span></th>
                                <td class="third-col"><span>@Model.contractPrice.OtherExpensesCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.OtherExpensesCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.OtherExpensesCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.OtherExpensesCost?.ToString("N2")</span></td>
                                @*Стоимость ?*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.OtherExpensesCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Всего, без НДС - Факт*@
                            <tr >
                                <th class="second-col"><span>Всего по договору без НДС (справочно)</span></th>
                                <td class="third-col"><span>@Model.contractPrice.TotalWithoutNds?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.TotalWithoutNds?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.TotalWithoutNds?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.TotalWithoutNds?.ToString("N2")</span></td>
                                @*Стоимость ?*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.TotalWithoutNds;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Материалы заказчика - Факт*@
                            <tr >
                                <th class="second-col"><span>Материалы генподрядчика</span></th>
                                <td class="third-col"><span>@Model.contractPrice.MaterialCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.MaterialCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.MaterialCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.MaterialCost?.ToString("N2")</span></td>
                                @*Стоимость Материалы*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.MaterialCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Оборудование заказчика - Факт*@
                            <tr>
                                <th class="second-col"><span>Оборудование Заказчика (справочно)</span></th>
                                <td class="third-col"><span>@Model.contractPrice.EquipmentClientCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.EquipmentClientCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.EquipmentClientCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.EquipmentClientCost?.ToString("N2")</span></td>
                                @*Стоимость Оборудование заказчика*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.EquipmentClientCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @if (ViewData["Main"] != null)
                            {
                                @*Объем работ - План своими силами*@
                                <tr id="planOur" >
                                    <th rowspan="9" class="first-col"><span>План cвоими силами</span></th>
                                    <th class="second-col"><span>Стоимость работ</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.TotalCost - Model.contractPriceOwn?.TotalCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.TotalCost - Model.workTodayYearOwn?.TotalCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.TotalCost - Model.remainingScopeOwn?.TotalCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.TotalCost - Model.todayScopeOwn?.TotalCost)?.ToString("N2"))</span></td>
                                    @*Стоимость ?*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.TotalCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.TotalCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.TotalCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*СМР - План своими силами*@
                                <tr >
                                    <th class="second-col"><span>Неизменная цена СМР</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.SmrCost - Model.contractPriceOwn?.SmrCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.SmrCost - Model.workTodayYearOwn?.SmrCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.SmrCost - Model.remainingScopeOwn?.SmrCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.SmrCost - Model.todayScopeOwn?.SmrCost)?.ToString("N2"))</span></td>
                                    @*Стоимость СМР*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.SmrCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.SmrCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.SmrCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*ПНР - План своими силами*@
                                <tr >
                                    <th class="second-col"><span>ПНР</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.PnrCost - Model.contractPriceOwn?.PnrCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.PnrCost - Model.workTodayYearOwn?.PnrCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.PnrCost - Model.remainingScopeOwn?.PnrCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.PnrCost - Model.todayScopeOwn?.PnrCost)?.ToString("N2"))</span></td>
                                    @*Стоимость ПНР*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.PnrCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.PnrCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.PnrCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*Доп. работы - План своими силами*@
                                <tr>
                                    <th class="second-col"><span>Доп. работы</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.AdditionalCost - Model.contractPriceOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.AdditionalCost - Model.workTodayYearOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.AdditionalCost - Model.remainingScopeOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.AdditionalCost - Model.todayScopeOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                    @*Стоимость Доп. работы*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.AdditionalCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.AdditionalCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.AdditionalCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*Оборудование - План своими силами*@
                                <tr >
                                    <th class="second-col"><span>Оборудование генподрядчика</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.EquipmentCost - Model.contractPriceOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.EquipmentCost - Model.workTodayYearOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.EquipmentCost - Model.remainingScopeOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.EquipmentCost - Model.todayScopeOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                    @*Стоимость Оборудование*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.PnrCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.PnrCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.PnrCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*Прочие работы - План своими силами*@
                                <tr >
                                    <th class="second-col"><span>Прочие работы и услуги</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.OtherExpensesCost - Model.contractPriceOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.OtherExpensesCost - Model.workTodayYearOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.OtherExpensesCost - Model.remainingScopeOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.OtherExpensesCost - Model.todayScopeOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.OtherExpensesCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.OtherExpensesCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.OtherExpensesCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*Всего, без НДС - План своими силами*@
                                <tr >
                                    <th class="second-col"><span>Всего по договору без НДС (справочно)</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.TotalWithoutNds - Model.contractPriceOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.TotalWithoutNds - Model.workTodayYearOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.TotalWithoutNds - Model.remainingScopeOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.TotalWithoutNds - Model.todayScopeOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                    @*Стоимость ?*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.TotalWithoutNds;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.TotalWithoutNds - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.TotalWithoutNds?.ToString("N2")</td>
                                        }
                                    }
                                </tr>
                               
                                @*Материалы - План своими силами*@
                                <tr>
                                    <th class="second-col"><span>Материалы генподрядчика</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.MaterialCost - Model.contractPriceOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.MaterialCost - Model.workTodayYearOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.MaterialCost - Model.remainingScopeOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.MaterialCost - Model.todayScopeOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                    @*Стоимость Материалы*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.MaterialCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.MaterialCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.MaterialCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*Оборудование заказчика - План своими силами*@
                                <tr>
                                    <th class="second-col"><span>Оборудование Заказчика (справочно)</span></th>
                                    <td class="third-col"><span>@Model.contractPrice.EquipmentClientCost?.ToString("N2")</span></td>
                                    <td class="fourth-col"><span>@Model.workTodayYear.EquipmentClientCost?.ToString("N2")</span></td>
                                    <td class="fifth-col"><span>@Model.remainingScope.EquipmentClientCost?.ToString("N2")</span></td>
                                    <td class="sixth-col"><span>@Model.todayScope.EquipmentClientCost?.ToString("N2")</span></td>
                                    @*Стоимость Оборудование заказчика*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        decimal? sum;
                                        if (obj != null)
                                        {
                                            sum = obj.EquipmentClientCost;
                                            if (sum != 0)
                                            {
                                                <td>
                                                    <span>@sum?.ToString("N2")</span>
                                                </td>
                                            }
                                            else
                                            {
                                                <td></td>
                                            }
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                </tr>

                                @*Объем работ - Факт своими силами*@
                                <tr id="factOur" >
                                    <th class="first-col" rowspan="9"><span>Факт своими силами</span></th>
                                    <th class="second-col"><span>Стоимость работ</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.TotalCost - Model.contractPriceOwn?.TotalCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.TotalCost - Model.workTodayYearOwn?.TotalCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.TotalCost - Model.remainingScopeOwn?.TotalCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.TotalCost - Model.todayScopeOwn?.TotalCost)?.ToString("N2"))</span></td>
                                    @*Период*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.TotalCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.TotalCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.TotalCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*СМР - Факт своими силами*@
                                <tr>
                                    <th class="second-col"><span>Неизменная цена СМР</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.SmrCost - Model.contractPriceOwn?.SmrCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.SmrCost - Model.workTodayYearOwn?.SmrCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.SmrCost - Model.remainingScopeOwn?.SmrCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.SmrCost - Model.todayScopeOwn?.SmrCost)?.ToString("N2"))</span></td>
                                    @*Стоимость СМР*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.SmrCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.SmrCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.SmrCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*ПНР - Факт своими силами*@                               
                                <tr>
                                    <th class="second-col"><span>ПНР</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.PnrCost - Model.contractPriceOwn?.PnrCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.PnrCost - Model.workTodayYearOwn?.PnrCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.PnrCost - Model.remainingScopeOwn?.PnrCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.PnrCost - Model.todayScopeOwn?.PnrCost)?.ToString("N2"))</span></td>
                                    @*Стоимость ПНР*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.PnrCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.PnrCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.PnrCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*Доп. работы - Факт своими силами*@
                                <tr>
                                    <th class="second-col"><span>Доп. работы</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.AdditionalCost - Model.contractPriceOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.AdditionalCost - Model.workTodayYearOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.AdditionalCost - Model.remainingScopeOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.AdditionalCost - Model.todayScopeOwn?.AdditionalCost)?.ToString("N2"))</span></td>
                                    @*Стоимость Доп. работы*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.AdditionalCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.AdditionalCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.AdditionalCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*Оборудование - Факт своими силами*@
                                <tr>
                                    <th class="second-col"><span>Оборудование генподрядчика</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.EquipmentCost - Model.contractPriceOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.EquipmentCost - Model.workTodayYearOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.EquipmentCost - Model.remainingScopeOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.EquipmentCost - Model.todayScopeOwn?.EquipmentCost)?.ToString("N2"))</span></td>
                                    @*Стоимость Оборудование*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.EquipmentCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.EquipmentCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.EquipmentCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*Прочие работы - Факт своими силами*@
                                <tr>
                                    <th class="second-col"><span>Прочие работы и услуги</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.OtherExpensesCost - Model.contractPriceOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.OtherExpensesCost - Model.workTodayYearOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.OtherExpensesCost - Model.remainingScopeOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.OtherExpensesCost - Model.todayScopeOwn?.OtherExpensesCost)?.ToString("N2"))</span></td>
                                    @*Стоимость ?*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.OtherExpensesCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.OtherExpensesCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.OtherExpensesCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*Всего, без НДС - Факт своими силами*@
                                <tr>
                                    <th class="second-col"><span>Всего по договору без НДС (справочно)</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.TotalWithoutNds - Model.contractPriceOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.TotalWithoutNds - Model.workTodayYearOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.TotalWithoutNds - Model.remainingScopeOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.TotalWithoutNds - Model.todayScopeOwn?.TotalWithoutNds)?.ToString("N2"))</span></td>
                                    @*Стоимость ?*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.TotalWithoutNds;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.TotalWithoutNds - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.TotalWithoutNds?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*Материалы - Факт своими силами*@
                                <tr>
                                    <th class="second-col"><span>Материалы генподрядчика</span></th>
                                    <td class="third-col"><span>@((Model.contractPrice.MaterialCost - Model.contractPriceOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                    <td class="fourth-col"><span>@((Model.workTodayYear.MaterialCost - Model.workTodayYearOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                    <td class="fifth-col"><span>@((Model.remainingScope.MaterialCost - Model.remainingScopeOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                    <td class="sixth-col"><span>@((Model.todayScope.MaterialCost - Model.todayScopeOwn?.MaterialCost)?.ToString("N2"))</span></td>
                                    @*Стоимость Материалы*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                    {
                                        var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.MaterialCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.MaterialCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.MaterialCost?.ToString("N2")</td>
                                        }
                                    }
                                </tr>

                                @*Оборудование заказчика - Факт своими силами*@
                                <tr>
                                    <th class="second-col"><span>Оборудование Заказчика (справочно)</span></th>
                                    <td class="third-col"><span>@Model.contractPrice.EquipmentClientCost?.ToString("N2")</span></td>
                                    <td class="fourth-col"><span>@Model.workTodayYear.EquipmentClientCost?.ToString("N2")</span></td>
                                    <td class="fifth-col"><span>@Model.remainingScope.EquipmentClientCost?.ToString("N2")</span></td>
                                    <td class="sixth-col"><span>@Model.todayScope.EquipmentClientCost?.ToString("N2")</span></td>
                                    @*Стоимость Оборудование заказчика*@
                                    @for (var iterator = Model.scopes.FirstOrDefault().Period;
                                   Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                                   iterator = iterator.Value.AddMonths(1))
                                   {
                                        var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                        var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                        decimal? sum = 0;
                                        foreach (var ob in obj)
                                        {
                                            if (obj != null)
                                            {
                                                sum += ob.EquipmentClientCost;
                                            }
                                        }
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@((sumFirst?.EquipmentClientCost - sum)?.ToString("N2"))</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>@sumFirst?.EquipmentClientCost?.ToString("N2")</td>
                                        }                                       
                                   }
                                </tr>
                            }
                        }
                        else
                        {
                            @*Объем услуг - План*@
                            <tr id="plan" >
                                <th class="first-col"><span>План</span></th>
                                <th class="second-col"><span>Объем услуг</span></th>
                                <td class="third-col"><span>@Model.contractPrice.SmrCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.SmrCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.SmrCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.SmrCost?.ToString("N2")</span></td>
                                @*Стоимость ?*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.SmrCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Объем услуг - Факт*@
                            <tr id="fact" >
                                <th class="first-col"><span>Факт</span></th>
                                <th class="second-col"><span>Объем услуг</span></th>
                                <td class="third-col"><span>@Model.contractPrice.SmrCost?.ToString("N2")</span></td>
                                <td class="fourth-col"><span>@Model.workTodayYear.SmrCost?.ToString("N2")</span></td>
                                <td class="fifth-col"><span>@Model.remainingScope.SmrCost?.ToString("N2")</span></td>
                                <td class="sixth-col"><span>@Model.todayScope.SmrCost?.ToString("N2")</span></td>
                                @*Период*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var obj = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    decimal? sum;
                                    if (obj != null)
                                    {
                                        sum = obj.SmrCost;
                                        if (sum != 0)
                                        {
                                            <td>
                                                <span>@sum?.ToString("N2")</span>
                                            </td>
                                        }
                                        else
                                        {
                                            <td></td>
                                        }
                                    }
                                    else
                                    {
                                        <td></td>
                                    }
                                }
                            </tr>

                            @*Объем услуг - План своими силами*@
                            <tr id="planOur" >
                                <th class="first-col"><span>План cвоими силами</span></th>
                                <th class="second-col"><span>Объем услуг</span></th>
                                <td class="third-col"><span>@((Model.contractPrice.SmrCost - Model.contractPriceOwn?.SmrCost)?.ToString("N2"))</span></td>
                                <td class="fourth-col"><span>@((Model.workTodayYear.SmrCost - Model.workTodayYearOwn?.SmrCost)?.ToString("N2"))</span></td>
                                <td class="fifth-col"><span>@((Model.remainingScope.SmrCost - Model.remainingScopeOwn?.SmrCost)?.ToString("N2"))</span></td>
                                <td class="sixth-col"><span>@((Model.todayScope.SmrCost - Model.todayScopeOwn?.SmrCost)?.ToString("N2"))</span></td>
                                @*Стоимость ?*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.scopes.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.scopesOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.SmrCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.SmrCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.SmrCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>

                            @*Объем услуг - Факт своими силами*@
                            <tr id="factOur" >
                                <th class="first-col"><span>Факт своими силами</span></th>
                                <th class="second-col"><span>Объем услуг</span></th>
                                <td class="third-col"><span>@((Model.contractPrice.SmrCost - Model.contractPriceOwn?.SmrCost)?.ToString("N2"))</span></td>
                                <td class="fourth-col"><span>@((Model.workTodayYear.SmrCost - Model.workTodayYearOwn?.SmrCost)?.ToString("N2"))</span></td>
                                <td class="fifth-col"><span>@((Model.remainingScope.SmrCost - Model.remainingScopeOwn?.SmrCost)?.ToString("N2"))</span></td>
                                <td class="sixth-col"><span>@((Model.todayScope.SmrCost - Model.todayScopeOwn?.SmrCost)?.ToString("N2"))</span></td>
                                @*Период*@
                                @for (var iterator = Model.scopes.FirstOrDefault().Period;
                               Checker.LessOrEquallyFirstDateByMonth((DateTime)iterator, (DateTime)Model.scopes.LastOrDefault().Period);
                               iterator = iterator.Value.AddMonths(1))
                                {
                                    var sumFirst = Model.facts.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).FirstOrDefault();
                                    var obj = Model.factsOwn.Where(x => Checker.EquallyDateByMonth((DateTime)x.Period, (DateTime)iterator)).ToList();
                                    decimal? sum = 0;
                                    foreach (var ob in obj)
                                    {
                                        if (obj != null)
                                        {
                                            sum += ob.SmrCost;
                                        }
                                    }
                                    if (sum != 0)
                                    {
                                        <td>
                                            <span>@((sumFirst?.SmrCost - sum)?.ToString("N2"))</span>
                                        </td>
                                    }
                                    else
                                    {
                                        <td>@sumFirst?.SmrCost?.ToString("N2")</td>
                                    }
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    window.addEventListener('resize', function (event) {
        addPositionToTable();
    }, true);

    window.onload = addPositionToTable();
    function funcChangeToCategories() {
        let elementTable = document.getElementById("ConstructionInstallationWorksByTypes")
        elementTable.classList.remove('show')
        elementTable.classList.add('d-none')

        let elementTable1 = document.getElementById("ConstructionInstallationWorksByCategories")
        elementTable1.classList.remove('d-none')
        elementTable1.classList.add('show')
        toLeft(".first-col", ".second-col");
        toLeft(".second-col", ".third-col");
        toLeft(".third-col", ".fourth-col");
        toLeft(".fourth-col", ".fifth-col");
        toLeft(".fifth-col", ".sixth-col");
    }

    function funcChangeToType() {
        let elementTable = document.getElementById("ConstructionInstallationWorksByCategories")
        elementTable.classList.remove('show')
        elementTable.classList.add('d-none')

        let elementTable1 = document.getElementById("ConstructionInstallationWorksByTypes")
        elementTable1.classList.remove('d-none')
        elementTable1.classList.add('show')
        toLeft(".first-col", ".second-col");
        toLeft(".second-col", ".third-col");
        toLeft(".third-col", ".fourth-col");
        toLeft(".fourth-col", ".fifth-col");
        toLeft(".fifth-col", ".sixth-col");
    }

    function funcCloseByTableCategories() {
        let elementTable = document.getElementById("ConstructionInstallationWorksByCategories")
        elementTable.classList.remove('show')
        elementTable.classList.add('d-none')
        $('#modDialog').modal('toggle');
    }

    function funcCloseByTableType() {
        let elementTable = document.getElementById("ConstructionInstallationWorksByTypes")
        elementTable.classList.remove('show')
        elementTable.classList.add('d-none')
        $('#modDialog').modal('toggle');
    }

    function toLeft(example, target) {
        var old = $(example);
        for (var i = 0; i < old.length; i++) {
            var width = $(example)[i].offsetWidth;
            if (width != 0) {
                var leftPrev = $(example)[i].style.left;
                break;
            }
        }
        leftPrev = leftPrev.substring(0, leftPrev.indexOf("p"))
        var leftPrevInt = parseInt(leftPrev);
        var all = $(target)
        for (var i = 0; i < all.length; i++) {
            all[i].style.left = +(width + leftPrevInt) + "px";
        }
    }

    function addPositionToTable() {
        var all = $(".first-col");
        for (var i = 0; i < all.length; i++) {
            all[i].style.left = "-10px";
        }

        toLeft(".first-col", ".second-col");
        toLeft(".second-col", ".third-col");
        toLeft(".third-col", ".fourth-col");
        toLeft(".fourth-col", ".fifth-col");
        toLeft(".fifth-col", ".sixth-col");
    }
</script>