@model MvcLayer.Models.DepartmentViewModel
@{
    ViewData["Title"] = "Отдел";
}


<div class="dm-overlay">
    <div class="dm-table">
        <div class="dm-cell">
            <div class="dm-modal">
                <div class="top-modal-block flex-column">
                    <div class="input-group m-2 ">
                        <span class="my-modal-title m-auto">@ViewData["Title"]</span>
                        <a asp-controller="Organizations" asp-action="Index" class="close-btn"></a>
                    </div>
                    <table class="table">
                        <tbody>
                            <tr>
                                <td class="col-sm-2">
                                    @Html.DisplayNameFor(model => model.Name)
                                </td>
                                <td class="col-sm-10">
                                    @Html.DisplayFor(model => model.Name)
                                </td>
                            </tr>
                            <tr>
                                <td class="col-sm-2">
                                    @Html.DisplayNameFor(model => model.Organization)
                                </td>
                                <td class="col-sm-10">
                                    @Html.DisplayFor(model => model.Organization.Name)
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="justify-content-between d-flex">
                        <button type="button" class="btn btn-success k-mr-2" onclick="location.href='@Url.Action("Edit", "Departments", new {id = Model.Id} )'">Изменить</button>

                        <button id="button-close" type="button" class="btn btn-danger k-mr-2" onclick="confirm()">Удалить</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    let val = @Model.Id;

    function confirm() {
        $.ajax({
            type: 'POST',
            url: '@Url.Action("ShowDelete","Departments")',
            contentType: "application/html; charset=utf-8",
            dataType: 'html',
            success: function (result) {
                $('#dialogContent').html(result);
                $('#modDialog').modal('show');

                let elementDeleteButton = document.querySelectorAll('#modal-button-delete')
                elementDeleteButton[0].addEventListener('click', () => {
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Action("ShowResultDelete","Departments")',
                        dataType: 'html',
                        data: { id: val },
                        success: function (result) {                            
                            let buttonElement = document.querySelectorAll('.close-btn')
                            buttonElement[0].click()
                        },
                        error: function (result) {
                            console.log(result, 'Ошибка удаления');
                            alert("Ошибка удаления");
                        }
                    });
                   
                })
            
             },
            error: function (result) {
                console.log(result,'error 2');
                alert("Ошибка отображения");
            }
        })
    }
</script>
